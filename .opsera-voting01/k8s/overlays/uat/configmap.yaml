apiVersion: v1
kind: ConfigMap
metadata:
  name: voting01-config
  labels:
    app.kubernetes.io/name: voting01
    environment: uat
data:
  # Redis Configuration (reuse DEV infrastructure)
  REDIS_HOST: voting01-dev-redis.2muj25.0001.usw2.cache.amazonaws.com
  REDIS_PORT: "6379"

  # PostgreSQL Configuration (reuse DEV infrastructure)
  DATABASE_HOST: voting01-dev-postgres.chwgk42cofpp.us-west-2.rds.amazonaws.com
  DATABASE_PORT: "5432"
  DATABASE_NAME: votes
  DATABASE_USER: postgres

  # AWS Secrets Manager ARN for DB credentials (reuse DEV)
  DATABASE_SECRET_ARN: arn:aws:secretsmanager:us-west-2:792373136340:secret:rds!db-90524015-d827-4f57-bed1-c14c12675556-pQeqiN

  # Application Settings
  ENVIRONMENT: uat
  LOG_LEVEL: info

  # ═══════════════════════════════════════════════════════════════════════════════
  # NEW RELIC APM CONFIGURATION
  # ═══════════════════════════════════════════════════════════════════════════════

  # Mock Server Configuration (override default collector.newrelic.com)
  NEW_RELIC_HOST: "opsera-opsera-newrelic-dev.agent.opsera.dev"

  # Common Settings (All Services)
  NEW_RELIC_DISTRIBUTED_TRACING_ENABLED: "true"
  NEW_RELIC_LOG_LEVEL: "info"
  NEW_RELIC_LABELS: "environment:uat;app:voting01;team:platform"

  # Environment (applies to all services)
  NEW_RELIC_ENVIRONMENT: "uat"

  # Node.js (Result) Settings
  NEW_RELIC_NO_CONFIG_FILE: "true"
  NEW_RELIC_APPLICATION_LOGGING_ENABLED: "true"
  NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED: "true"

  # ═══════════════════════════════════════════════════════════════════════════════
  # ERROR SIMULATION CONFIGURATION (Canary Rollback Testing)
  # ═══════════════════════════════════════════════════════════════════════════════
  # Enable via UI toggle or set to "true" to start with errors enabled
  ERROR_SIM_ENABLED: "false"
  # Error rate when simulation is active (0.5 = 50% of requests fail)
  ERROR_SIM_RATE: "0.5"
  # Auto-disable after N seconds (safety net to prevent accidental prolonged errors)
  ERROR_SIM_AUTO_DISABLE_SECONDS: "300"
